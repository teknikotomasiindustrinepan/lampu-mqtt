<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Lampu Virtual MQTT</title>

  <!-- MQTT.js -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }

    .lampu {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      margin: 30px auto;
      background-color: gray;
      box-shadow: 0 0 10px #999;
    }

    .on {
      background-color: yellow;
      box-shadow: 0 0 30px gold;
    }

    .off {
      background-color: gray;
    }
  </style>
</head>
<body>

  <h2>Kontrol Lampu Virtual</h2>
  <p>Website → MQTT → Node-RED → MQTT → Website</p>

  <button onclick="lampuOn()">Lampu ON</button>
  <button onclick="lampuOff()">Lampu OFF</button>

  <div id="lampu" class="lampu off"></div>

  <p>Status: <strong id="statusText">MENUNGGU...</strong></p>

  <script>
    // Koneksi ke HiveMQ WebSocket
    const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

    client.on("connect", () => {
      console.log("MQTT Connected");
      client.subscribe("smk/japara/lab1/status/lampu");
    });

    client.on("message", (topic, message) => {
      const data = JSON.parse(message.toString());

      const lampu = document.getElementById("lampu");
      const statusText = document.getElementById("statusText");

      if (data.status === "ON") {
        lampu.className = "lampu on";
        statusText.innerText = "ON";
      } else if (data.status === "OFF") {
        lampu.className = "lampu off";
        statusText.innerText = "OFF";
      }
    });

    function lampuOn() {
      client.publish(
        "smk/japara/lab1/cmd/lampu",
        JSON.stringify({ command: "ON" })
      );
    }

    function lampuOff() {
      client.publish(
        "smk/japara/lab1/cmd/lampu",
        JSON.stringify({ command: "OFF" })
      );
    }
  </script>

</body>
</html>
