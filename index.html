<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kontrol Lampu ESP32</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      margin: 10px;
    }
    #status {
      font-weight: bold;
      font-size: 20px;
    }
  </style>
</head>
<body>

  <h1>Kontrol Lampu ESP32</h1>

  <button onclick="lampOn()">ON</button>
  <button onclick="lampOff()">OFF</button>

  <p>Status Lampu: <span id="status">-</span></p>
  <p>Status MQTT: <span id="mqtt">Disconnected</span></p>

<script>
  const options = {
    username: "mqtt_user",
    password: "mqtt_pass",
    protocol: "wss"
  };

  const client = mqtt.connect(
    "wss://broker.hivemq.com:8884/mqtt",
    options
  );

  client.on("connect", function () {
    document.getElementById("mqtt").innerText = "Connected";
    client.subscribe("lampu/esp32_01/status");
  });

  client.on("message", function (topic, message) {
    if (topic === "lampu/esp32_01/status") {
      document.getElementById("status").innerText = message.toString();
    }
  });

  function lampOn() {
    client.publish("lampu/esp32_01/cmd", "ON");
  }

  function lampOff() {
    client.publish("lampu/esp32_01/cmd", "OFF");
  }
</script>

</body>
</html>
